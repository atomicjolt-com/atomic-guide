# Story 7.3: AI Chat Assessment System - Frontend Specifications

**Date:** September 16, 2025
**Author:** UX Expert
**Version:** 1.0
**Status:** Ready for Development

## 📋 Executive Summary

This document provides comprehensive frontend specifications for Story 7.3's AI Chat Assessment System. The system delivers conversational assessments to students through a natural chat interface that reduces test anxiety while providing real-time feedback and automatic grade passback to Canvas.

### Key Features Specified:
- Conversational assessment chat interface with natural language processing
- Real-time AI response visualization with typing indicators
- Progress tracking and mastery visualization components
- Accessible design for diverse learners (WCAG 2.1 AA+)
- Responsive mobile-first design for Canvas iframe integration
- Error handling and recovery flows for assessment continuity
- Multi-modal content support for rich assessment interactions

---

## 🎯 Design Principles & User Experience Goals

### Primary UX Objectives
1. **Reduce Test Anxiety**: Natural conversation style eliminates traditional testing stress
2. **Immediate Feedback**: Real-time responses help students learn during assessment
3. **Clear Progress**: Visual indicators show advancement toward mastery
4. **Accessible Learning**: Support for all learners regardless of abilities
5. **Seamless Integration**: Feels native within Canvas environment

### Design Philosophy
- **Conversation-First**: Prioritize natural dialogue over formal testing interface
- **Encouraging Progression**: Celebrate learning milestones and provide supportive feedback
- **Transparent Process**: Students understand their progress and next steps
- **Adaptive Experience**: Interface adjusts to individual learning patterns
- **Trust Building**: Clear communication about AI assessment and scoring

---

## 🏗️ Component Architecture

### Feature Structure (Vertical Slice)
```
src/features/ai-assessment/
├── client/
│   ├── components/
│   │   ├── chat/
│   │   │   ├── ConversationalAssessmentInterface.tsx
│   │   │   ├── AssessmentChatMessage.tsx
│   │   │   ├── TypingIndicator.tsx
│   │   │   ├── ResponseInput.tsx
│   │   │   └── MessageReactionPanel.tsx
│   │   ├── progress/
│   │   │   ├── AssessmentProgressTracker.tsx
│   │   │   ├── MasteryVisualization.tsx
│   │   │   ├── TimeManagement.tsx
│   │   │   └── ConceptProgressMap.tsx
│   │   ├── multimedia/
│   │   │   ├── MultiModalQuestionDisplay.tsx
│   │   │   ├── ImageResponseCapture.tsx
│   │   │   ├── AudioResponseRecorder.tsx
│   │   │   └── FileUploadAssessment.tsx
│   │   ├── feedback/
│   │   │   ├── RealTimeFeedbackPanel.tsx
│   │   │   ├── MasteryCheckpoint.tsx
│   │   │   ├── RemedationSuggestions.tsx
│   │   │   └── EncouragementSystem.tsx
│   │   ├── completion/
│   │   │   ├── AssessmentSummary.tsx
│   │   │   ├── PerformanceBreakdown.tsx
│   │   │   ├── NextStepsGuidance.tsx
│   │   │   └── GradePassbackStatus.tsx
│   │   ├── accessibility/
│   │   │   ├── ScreenReaderAssessment.tsx
│   │   │   ├── KeyboardNavigationHelper.tsx
│   │   │   ├── HighContrastMode.tsx
│   │   │   └── TextSizeController.tsx
│   │   └── shared/
│   │       ├── AssessmentErrorBoundary.tsx
│   │       ├── LoadingStates.tsx
│   │       ├── EmptyStates.tsx
│   │       └── SecurityValidation.tsx
│   ├── hooks/
│   │   ├── useConversationalAssessment.ts
│   │   ├── useAssessmentProgress.ts
│   │   ├── useRealTimeFeedback.ts
│   │   ├── useMultiModalInput.ts
│   │   ├── useAccessibilityFeatures.ts
│   │   └── useAssessmentSecurity.ts
│   ├── services/
│   │   ├── conversationService.ts
│   │   ├── progressTracking.ts
│   │   ├── feedbackService.ts
│   │   └── accessibilityService.ts
│   └── stores/
│       ├── assessmentStore.ts
│       ├── progressStore.ts
│       └── accessibilityStore.ts
```

---

## 🎨 Visual Design System Integration

### Color Palette for Assessment Interface

```css
:root {
  /* Primary Brand Colors */
  --yellow-primary: #FFDD00;
  --yellow-dark: #EBCB00;
  --yellow-light: #FFEB66;
  --off-white: #FFFDF0;

  /* Assessment-Specific Colors */
  --assessment-progress: #027A48;
  --assessment-progress-light: #ECFDF3;
  --mastery-achieved: #059669;
  --mastery-partial: #F59E0B;
  --need-practice: #EF4444;

  /* Conversation Colors */
  --ai-message-bg: #F8FAFC;
  --ai-message-border: #E2E8F0;
  --student-message-bg: #FFFDF0;
  --student-message-border: #FFDD00;
  --typing-indicator: #8B5CF6;

  /* Accessibility Colors */
  --high-contrast-bg: #000000;
  --high-contrast-text: #FFFFFF;
  --focus-ring: #2563EB;
  --error-accessible: #DC2626;
  --success-accessible: #16A34A;
}
```

### Typography for Assessment Interface

```css
/* Assessment Chat Typography */
.assessment-message {
  font-family: 'Rubik', sans-serif;
  font-size: 1rem;
  line-height: 1.6;
  color: var(--neutral-dark);
}

.assessment-question {
  font-size: 1.125rem;
  font-weight: 500;
  line-height: 1.5;
  margin-bottom: 1rem;
}

.assessment-feedback {
  font-size: 0.875rem;
  line-height: 1.5;
  color: var(--neutral-base);
}

.mastery-indicator {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Large text mode for accessibility */
.text-large {
  font-size: 1.25rem !important;
  line-height: 1.7 !important;
}

.text-xl {
  font-size: 1.5rem !important;
  line-height: 1.8 !important;
}
```

### Shadow and Elevation System

```css
.chat-container { box-shadow: var(--shadow-medium); }
.progress-panel { box-shadow: var(--shadow-small); }
.mastery-celebration { box-shadow: var(--shadow-large); }
.assessment-modal { box-shadow: var(--shadow-xlarge); }
```

---

## 🗣️ Core Chat Interface Components

### 1. Conversational Assessment Interface

#### Component: `ConversationalAssessmentInterface.tsx`

**Purpose**: Main chat interface for student assessment interactions

**Design Specifications**:
- **Full-height layout** optimized for Canvas iframe constraints
- **Chat-style message flow** with clear AI vs. student message distinction
- **Real-time interaction** with typing indicators and immediate responses
- **Contextual progress tracking** integrated into chat header
- **Accessibility-first design** with ARIA live regions

```typescript
interface ConversationalAssessmentInterfaceProps {
  assessmentSessionId: string;
  canvasContext: CanvasAssignmentContext;
  assessmentConfiguration: AssessmentConfiguration;
  onAssessmentComplete: (results: AssessmentResults) => void;
  onAssessmentExit: () => void;
  accessibilityPreferences: AccessibilityPreferences;
}

interface AssessmentMessage {
  id: string;
  type: 'ai_question' | 'ai_feedback' | 'student_response' | 'system_message';
  content: string;
  timestamp: Date;
  multimedia?: MultiModalContent;
  analysis?: MessageAnalysis;
  isStreaming?: boolean;
}

interface MessageAnalysis {
  comprehensionScore: number;
  confidence: number;
  detectedMisconceptions: string[];
  masteryIndicators: string[];
  feedbackType: 'encouragement' | 'correction' | 'extension';
}
```

**Visual Layout**:
```
┌─────────────────────────────────────────┐
│ 📚 Biology Quiz • Progress: 3/5 ⭐     │ ← Assessment Header
│ ⏱️ 12:34 remaining                      │
├─────────────────────────────────────────┤
│ 🤖 Let's explore cellular respiration!  │ ← AI Message
│    What happens during glycolysis?      │
│    📊 Confidence: Understanding well    │
├─────────────────────────────────────────┤
│ 👤 Glucose gets broken down into       │ ← Student Message
│    pyruvate and ATP is produced        │
│    ✓ Great understanding! 🎉          │
├─────────────────────────────────────────┤
│ 🤖 Excellent! Now let's dive deeper... │ ← AI Follow-up
│    ● ● ● (typing...)                   │ ← Typing Indicator
├─────────────────────────────────────────┤
│ [Type your response here...]           │ ← Input Area
│ 🎤 📷 📁 😊                           │
└─────────────────────────────────────────┘
```

**Accessibility Features**:
- Screen reader announcements for new messages
- Keyboard navigation between messages
- High contrast mode support
- Text scaling capabilities
- Voice input/output options

#### Component: `AssessmentChatMessage.tsx`

**Purpose**: Individual message display with contextual information

```typescript
interface AssessmentChatMessageProps {
  message: AssessmentMessage;
  isLatest: boolean;
  showAnalysis: boolean;
  onMessageReaction?: (messageId: string, reaction: string) => void;
  onContentExpand?: (messageId: string) => void;
  accessibilityMode: 'standard' | 'high-contrast' | 'large-text';
}
```

**Visual States**:
- **AI Messages**: Light background with AI avatar and confidence indicators
- **Student Messages**: Branded background with validation checkmarks
- **System Messages**: Neutral styling for progress updates
- **Loading Messages**: Skeleton animation while AI processes response

#### Component: `TypingIndicator.tsx`

**Purpose**: Real-time feedback showing AI is processing student response

```typescript
interface TypingIndicatorProps {
  isVisible: boolean;
  processingType: 'analyzing' | 'generating' | 'evaluating';
  estimatedTime?: number;
  customMessage?: string;
}
```

**Animation Specifications**:
- Smooth fade-in/out transitions (300ms)
- Pulsing dots animation for processing indication
- Color coding for different processing types
- Accessible alternative for screen readers

### 2. Response Input Interface

#### Component: `ResponseInput.tsx`

**Purpose**: Multi-modal input interface for student responses

**Design Specifications**:
- **Auto-expanding textarea** with smart sizing
- **Multi-modal input buttons** for images, audio, files
- **Real-time validation** with helpful error messages
- **Keyboard shortcuts** for common actions
- **Voice-to-text support** for accessibility

```typescript
interface ResponseInputProps {
  onResponseSubmit: (response: StudentResponse) => void;
  allowedInputTypes: InputType[];
  characterLimit?: number;
  showCharacterCount: boolean;
  placeholder: string;
  isDisabled: boolean;
  validationRules: ValidationRule[];
  accessibilityFeatures: InputAccessibilityFeatures;
}

interface StudentResponse {
  text?: string;
  multimedia?: {
    type: 'image' | 'audio' | 'video' | 'document';
    file: File;
    description?: string;
  }[];
  metadata: {
    inputMethod: 'typing' | 'voice' | 'upload';
    responseTime: number;
    editCount: number;
  };
}
```

**Visual Layout**:
```
┌─────────────────────────────────────────┐
│ [Your response here...                 ]│ ← Text Input
│                                         │
│ 🎤 Voice   📷 Image   📁 File   😊 Emoji│ ← Input Options
│                              235/500    │ ← Character Count
│ ⌨️ Press Enter to send, Shift+Enter for new line │
└─────────────────────────────────────────┘
```

---

## 📊 Progress Tracking Components

### 1. Assessment Progress Tracker

#### Component: `AssessmentProgressTracker.tsx`

**Purpose**: Real-time visual progress display integrated into chat interface

**Design Specifications**:
- **Compact header integration** that doesn't interfere with chat flow
- **Multi-dimensional progress** showing concepts, time, and mastery
- **Celebratory animations** for milestone achievements
- **Clear remaining requirements** with encouraging messaging

```typescript
interface AssessmentProgressTrackerProps {
  sessionId: string;
  totalConcepts: number;
  masteredConcepts: number;
  currentConcept: string;
  timeRemaining?: number;
  masteryThreshold: number;
  onProgressUpdate: (progress: ProgressUpdate) => void;
  showDetailedView: boolean;
}

interface ConceptProgress {
  conceptId: string;
  name: string;
  status: 'not-started' | 'in-progress' | 'partial' | 'mastered';
  attempts: number;
  confidence: number;
  timeSpent: number;
}
```

**Visual Design**:
```
┌─────────────────────────────────────────┐
│ 🧬 Cellular Respiration Assessment      │
│ ⭐⭐⭐☆☆ Progress: 3/5 concepts         │
│ 🎯 Current: ATP Production              │
│ ⏱️ 15:30 remaining                      │
│ ┌─┬─┬─┬─┬─┐                            │
│ │✓│✓│●│ │ │ Concept progress bar        │
│ └─┴─┴─┴─┴─┘                            │
└─────────────────────────────────────────┘
```

#### Component: `MasteryVisualization.tsx`

**Purpose**: Visual representation of concept mastery and learning progress

```typescript
interface MasteryVisualizationProps {
  concepts: ConceptProgress[];
  masteryThreshold: number;
  showConfidenceScores: boolean;
  animationSpeed: 'slow' | 'normal' | 'fast' | 'none';
  onConceptSelect?: (conceptId: string) => void;
}
```

**Accessibility**:
- Text descriptions of visual progress
- Keyboard navigation through concepts
- Screen reader progress announcements
- High contrast color schemes

### 2. Time Management Interface

#### Component: `TimeManagement.tsx`

**Purpose**: Non-intrusive time tracking with optional limits and warnings

```typescript
interface TimeManagementProps {
  totalTimeLimit?: number;
  warningThresholds: number[];
  showCountdown: boolean;
  onTimeWarning: (remainingTime: number) => void;
  onTimeExpired: () => void;
  allowExtensions: boolean;
}
```

**Design Principles**:
- **Non-anxiety inducing**: Gentle reminders rather than stressful countdowns
- **Flexible warnings**: Customizable alert timing based on assessment type
- **Grace periods**: Allow completion of current question when time expires
- **Accessible alternatives**: Audio cues and screen reader announcements

---

## 🎯 Real-Time Feedback Components

### 1. Real-Time Feedback Panel

#### Component: `RealTimeFeedbackPanel.tsx`

**Purpose**: Immediate, contextual feedback integrated into conversation flow

**Design Specifications**:
- **Inline feedback** that appears naturally in conversation
- **Contextual suggestions** for improvement without discouragement
- **Positive reinforcement** for correct understanding
- **Adaptive difficulty** based on student performance

```typescript
interface RealTimeFeedbackPanelProps {
  studentResponse: string;
  analysis: ResponseAnalysis;
  feedbackStyle: 'encouraging' | 'corrective' | 'neutral';
  showConfidenceScore: boolean;
  onFeedbackInteraction: (action: FeedbackAction) => void;
  personalizedSupport: PersonalizedSupport;
}

interface ResponseAnalysis {
  correctnessScore: number;
  comprehensionLevel: number;
  identifiedGaps: KnowledgeGap[];
  strengths: string[];
  improvementAreas: string[];
  nextSteps: string[];
}

interface FeedbackAction {
  type: 'clarification_request' | 'hint_request' | 'concept_review' | 'continue';
  context?: string;
}
```

**Feedback Visualization**:
```
┌─────────────────────────────────────────┐
│ 🎉 Great work! You've grasped the key  │
│    concept of ATP production.           │
│                                         │
│ 💡 Want to explore further?             │
│    • What role does oxygen play?        │
│    • How is this different in plants?   │
│                                         │
│ 📈 Understanding: ████████░░ 80%        │
│ 🏆 Mastery Progress: +15 points        │
└─────────────────────────────────────────┘
```

#### Component: `MasteryCheckpoint.tsx`

**Purpose**: Celebratory interface when students achieve concept mastery

```typescript
interface MasteryCheckpointProps {
  conceptName: string;
  masteryLevel: number;
  timeToMastery: number;
  celebrationStyle: 'subtle' | 'moderate' | 'enthusiastic';
  onContinue: () => void;
  onReview: () => void;
  achievements: Achievement[];
}
```

**Celebration Design**:
- Animated congratulations with concept-specific imagery
- Progress badges and achievement unlocks
- Encouraging messages about learning journey
- Options to review mastered content or continue

### 2. Remediation and Support

#### Component: `RemediationSuggestions.tsx`

**Purpose**: Supportive guidance when students struggle with concepts

```typescript
interface RemediationSuggestionsProps {
  strugglingConcept: string;
  identifiedGaps: KnowledgeGap[];
  supportStrategies: SupportStrategy[];
  canvasResources: CanvasResource[];
  onStrategySelect: (strategy: SupportStrategy) => void;
  personalizedRecommendations: PersonalizedRecommendation[];
}

interface SupportStrategy {
  id: string;
  type: 'visual' | 'textual' | 'interactive' | 'peer-discussion';
  title: string;
  description: string;
  estimatedTime: number;
  canvasResourceId?: string;
}
```

**Support Interface Design**:
```
┌─────────────────────────────────────────┐
│ 🤝 Let's work through this together!    │
│                                         │
│ I noticed you might benefit from:       │
│ 📖 Reviewing the diagram on page 45     │
│ 🎥 Watching the ATP cycle animation     │
│ 🗣️ Discussing with a study partner     │
│                                         │
│ 💪 You've got this! Take your time.    │
│                                         │
│ [Review Resources] [Try Again] [Skip]   │
└─────────────────────────────────────────┘
```

---

## 📱 Responsive Design Specifications

### Breakpoint Strategy (Mobile-First)

```css
/* Canvas Iframe Constraints */
.assessment-container {
  min-height: 500px;
  max-height: 80vh;
}

/* Mobile (320px - 767px) */
@media (max-width: 767px) {
  .chat-interface {
    padding: 0.5rem;
    font-size: 0.9rem;
  }

  .response-input {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-top: 1px solid var(--neutral-light);
  }

  .progress-tracker {
    display: none; /* Show in collapsed state */
  }

  .progress-toggle {
    display: block;
  }
}

/* Tablet (768px - 1023px) */
@media (min-width: 768px) and (max-width: 1023px) {
  .chat-interface {
    display: grid;
    grid-template-columns: 1fr 250px;
    gap: 1rem;
  }

  .progress-tracker {
    position: sticky;
    top: 0;
    height: fit-content;
  }
}

/* Desktop (1024px+) */
@media (min-width: 1024px) {
  .chat-interface {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 1.5rem;
  }

  .message-container {
    max-width: 600px;
  }
}
```

### Canvas Iframe Optimization

```typescript
// Responsive container that adapts to Canvas iframe constraints
const useCanvasResponsive = () => {
  const [containerSize, setContainerSize] = useState({ width: 0, height: 0 });

  useEffect(() => {
    const updateSize = () => {
      if (window.frameElement) {
        const rect = window.frameElement.getBoundingClientRect();
        setContainerSize({ width: rect.width, height: rect.height });
      }
    };

    window.addEventListener('resize', updateSize);
    updateSize();

    return () => window.removeEventListener('resize', updateSize);
  }, []);

  return containerSize;
};
```

### Touch Interface Optimizations

- **Minimum touch targets**: 44x44px for all interactive elements
- **Swipe gestures**: Navigate between messages and concepts
- **Pull-to-refresh**: Reload assessment state
- **Long-press actions**: Context menus for accessibility options

---

## ♿ Accessibility Requirements (WCAG 2.1 AA+)

### Comprehensive Accessibility Features

#### 1. Screen Reader Support

```typescript
// ARIA live regions for dynamic content
const AssessmentAriaLive = () => (
  <>
    <div
      aria-live="polite"
      aria-atomic="true"
      className="sr-only"
      id="assessment-status"
    >
      {currentStatus}
    </div>

    <div
      aria-live="assertive"
      aria-atomic="true"
      className="sr-only"
      id="assessment-alerts"
    >
      {urgentAlerts}
    </div>
  </>
);

// Comprehensive ARIA labeling
const ChatMessage = ({ message, analysis }: ChatMessageProps) => (
  <div
    role="article"
    aria-labelledby={`message-${message.id}-header`}
    aria-describedby={`message-${message.id}-content`}
    className="chat-message"
  >
    <h3 id={`message-${message.id}-header`} className="sr-only">
      {message.type === 'ai_question' ? 'AI Question' : 'Your Response'}
      {analysis && `, Confidence Score: ${analysis.confidence}%`}
    </h3>

    <div id={`message-${message.id}-content`}>
      {message.content}
    </div>
  </div>
);
```

#### 2. Keyboard Navigation

```typescript
const useKeyboardNavigation = () => {
  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      switch (event.key) {
        case 'Tab':
          // Custom tab order through messages
          break;
        case 'ArrowUp':
        case 'ArrowDown':
          // Navigate through message history
          break;
        case 'Enter':
          if (event.ctrlKey) {
            // Submit response with Ctrl+Enter
            submitResponse();
          }
          break;
        case 'Escape':
          // Focus on input or exit assessment
          break;
      }
    };

    document.addEventListener('keydown', handleKeyDown);
    return () => document.removeEventListener('keydown', handleKeyDown);
  }, []);
};
```

#### 3. Visual Accessibility

##### Component: `HighContrastMode.tsx`

```typescript
interface HighContrastModeProps {
  isEnabled: boolean;
  onToggle: () => void;
  contrastLevel: 'standard' | 'enhanced' | 'maximum';
}

// High contrast color schemes
const highContrastTheme = {
  standard: {
    background: '#FFFFFF',
    text: '#000000',
    border: '#666666',
    accent: '#0000FF'
  },
  enhanced: {
    background: '#FFFFFF',
    text: '#000000',
    border: '#000000',
    accent: '#FF0000'
  },
  maximum: {
    background: '#000000',
    text: '#FFFFFF',
    border: '#FFFFFF',
    accent: '#FFFF00'
  }
};
```

##### Component: `TextSizeController.tsx`

```typescript
interface TextSizeControllerProps {
  currentSize: 'small' | 'normal' | 'large' | 'xl';
  onSizeChange: (size: string) => void;
  showInInterface: boolean;
}

// Dynamic text scaling
const textSizeClasses = {
  small: 'text-sm',
  normal: 'text-base',
  large: 'text-lg',
  xl: 'text-xl'
};
```

#### 4. Cognitive Accessibility

- **Simple language patterns** in AI responses
- **Clear progress indicators** with minimal cognitive load
- **Consistent navigation patterns** throughout assessment
- **Error prevention** with clear validation messages
- **Timeout warnings** with easy extension options

### Accessibility Testing Requirements

```typescript
// Automated accessibility testing
describe('Assessment Accessibility', () => {
  it('should meet WCAG 2.1 AA standards', async () => {
    const { container } = render(<ConversationalAssessmentInterface {...props} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('should support keyboard navigation', async () => {
    const user = userEvent.setup();
    render(<ConversationalAssessmentInterface {...props} />);

    // Tab through all interactive elements
    await user.tab();
    expect(screen.getByRole('button', { name: /settings/i })).toHaveFocus();

    await user.tab();
    expect(screen.getByRole('textbox', { name: /response/i })).toHaveFocus();
  });

  it('should announce progress updates', async () => {
    const user = userEvent.setup();
    render(<ConversationalAssessmentInterface {...props} />);

    // Simulate mastery achievement
    fireEvent.click(screen.getByRole('button', { name: /submit response/i }));

    await waitFor(() => {
      expect(screen.getByRole('status')).toHaveTextContent(
        'Concept mastered! Progress: 4 of 5 concepts complete'
      );
    });
  });
});
```

---

## 🔄 Real-Time Interaction Flows

### 1. Assessment Initiation Flow

```typescript
const AssessmentInitiationFlow = () => {
  const [initializationStep, setInitializationStep] = useState<
    'loading' | 'context-check' | 'student-ready' | 'assessment-start'
  >('loading');

  const steps = [
    {
      id: 'loading',
      title: 'Loading Assessment',
      description: 'Preparing your personalized assessment experience...',
      duration: 2000
    },
    {
      id: 'context-check',
      title: 'Canvas Integration',
      description: 'Connecting to your course content...',
      duration: 1500
    },
    {
      id: 'student-ready',
      title: 'Ready to Begin',
      description: 'Everything is set up! Are you ready to start?',
      userAction: true
    }
  ];
};
```

### 2. Conversation Flow Management

```typescript
interface ConversationFlow {
  sessionId: string;
  currentQuestionId?: string;
  conversationContext: ConversationContext;
  adaptationRules: AdaptationRule[];
  errorRecoveryState?: ErrorRecoveryState;
}

interface ConversationContext {
  messagesHistory: AssessmentMessage[];
  conceptProgress: ConceptProgress[];
  studentLearningProfile: LearningProfile;
  currentDifficulty: number;
  detectedStruggles: string[];
}

const useConversationFlow = (sessionId: string) => {
  const [flow, setFlow] = useState<ConversationFlow>();
  const [isProcessing, setIsProcessing] = useState(false);
  const [errorState, setErrorState] = useState<string | null>(null);

  const submitResponse = async (response: StudentResponse) => {
    setIsProcessing(true);
    try {
      const aiAnalysis = await analyzeResponse(response, flow?.conversationContext);
      const nextQuestion = await generateNextQuestion(aiAnalysis, flow?.adaptationRules);

      // Update conversation flow
      setFlow(current => ({
        ...current!,
        conversationContext: {
          ...current!.conversationContext,
          messagesHistory: [
            ...current!.conversationContext.messagesHistory,
            {
              id: generateId(),
              type: 'student_response',
              content: response.text || '',
              timestamp: new Date(),
              analysis: aiAnalysis
            },
            nextQuestion
          ]
        }
      }));
    } catch (error) {
      setErrorState('Failed to process response. Please try again.');
    } finally {
      setIsProcessing(false);
    }
  };

  return { flow, isProcessing, errorState, submitResponse };
};
```

### 3. Error Recovery Flows

#### Component: `AssessmentErrorBoundary.tsx`

```typescript
interface AssessmentErrorBoundaryProps {
  children: React.ReactNode;
  onError: (error: Error, errorInfo: ErrorInfo) => void;
  fallbackComponent?: React.ComponentType<ErrorFallbackProps>;
}

interface ErrorFallbackProps {
  error: Error;
  onRetry: () => void;
  onReportError: () => void;
  sessionId: string;
}

const DefaultErrorFallback = ({ error, onRetry, onReportError }: ErrorFallbackProps) => (
  <div className="error-boundary" role="alert">
    <h2>Assessment Temporarily Unavailable</h2>
    <p>
      Don't worry! Your progress has been saved.
      You can continue where you left off.
    </p>

    <div className="error-actions">
      <button onClick={onRetry} className="btn-primary">
        Try Again
      </button>
      <button onClick={onReportError} className="btn-secondary">
        Report Issue
      </button>
    </div>

    <details className="error-details">
      <summary>Technical Details</summary>
      <pre>{error.message}</pre>
    </details>
  </div>
);
```

#### Network Error Recovery

```typescript
const useNetworkRecovery = () => {
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [pendingResponses, setPendingResponses] = useState<StudentResponse[]>([]);

  useEffect(() => {
    const handleOnline = () => {
      setIsOnline(true);
      // Retry pending responses
      pendingResponses.forEach(response => {
        submitResponse(response).catch(console.error);
      });
      setPendingResponses([]);
    };

    const handleOffline = () => {
      setIsOnline(false);
    };

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, [pendingResponses]);

  return { isOnline, pendingResponses, addPendingResponse: setPendingResponses };
};
```

---

## 📋 Assessment Completion Components

### 1. Assessment Summary Interface

#### Component: `AssessmentSummary.tsx`

**Purpose**: Comprehensive results display with learning insights

```typescript
interface AssessmentSummaryProps {
  assessmentResults: AssessmentResults;
  performanceBreakdown: PerformanceBreakdown;
  nextStepsGuidance: NextStepsGuidance;
  canvasGradeStatus: GradePassbackStatus;
  onReturnToCourse: () => void;
  onRetakeAssessment?: () => void;
  showDetailedAnalysis: boolean;
}

interface AssessmentResults {
  sessionId: string;
  finalScore: number;
  masteredConcepts: string[];
  partialConcepts: string[];
  strugglingConcepts: string[];
  totalTime: number;
  completionRate: number;
  confidenceScores: Record<string, number>;
}
```

**Visual Layout**:
```
┌─────────────────────────────────────────┐
│ 🎉 Assessment Complete!                 │
│                                         │
│ Your Score: 85/100 ⭐⭐⭐⭐☆           │
│ Time: 23:45 of 30:00                   │
│                                         │
│ 📊 Concept Mastery:                    │
│ ✅ ATP Production (95%)                 │
│ ✅ Electron Transport (88%)            │
│ ⚠️ Krebs Cycle (72%)                   │
│ ❌ Glycolysis (45%)                    │
│                                         │
│ 🎯 What's Next:                        │
│ • Review glycolysis diagram (Page 42)   │
│ • Practice Krebs cycle questions        │
│ • You're ready for the next module!    │
│                                         │
│ 📤 Grade: Sent to Canvas ✓             │
│                                         │
│ [Return to Course] [Review Answers]     │
└─────────────────────────────────────────┘
```

#### Component: `PerformanceBreakdown.tsx`

**Purpose**: Detailed analysis of student performance patterns

```typescript
interface PerformanceBreakdownProps {
  performanceMetrics: PerformanceMetrics;
  learningInsights: LearningInsights;
  comparisonData?: ComparisonData;
  showVisualizations: boolean;
}

interface PerformanceMetrics {
  averageResponseTime: number;
  confidenceProgression: number[];
  difficultyAdaptation: DifficultyChange[];
  mistakePatterns: MistakePattern[];
  improvementAreas: ImprovementArea[];
}
```

### 2. Grade Passback Status

#### Component: `GradePassbackStatus.tsx`

**Purpose**: Real-time status of Canvas grade integration

```typescript
interface GradePassbackStatusProps {
  status: 'pending' | 'processing' | 'success' | 'failed' | 'retry';
  gradeData: CanvasGradeData;
  onRetryPassback?: () => void;
  showDetails: boolean;
}

interface CanvasGradeData {
  scoreGiven: number;
  scoreMaximum: number;
  comment: string;
  submittedAt: Date;
  canvasAssignmentId: string;
  attemptNumber: number;
}
```

**Status Visualization**:
```
┌─────────────────────────────────────────┐
│ 📤 Canvas Grade Passback                │
│                                         │
│ Status: ✅ Successfully sent            │
│ Score: 85/100                          │
│ Assignment: Biology Quiz #3             │
│ Submitted: Oct 15, 2025 at 2:34 PM    │
│                                         │
│ 📝 Instructor Feedback:                │
│ "Great understanding of cellular       │
│  respiration! Review glycolysis for    │
│  better mastery."                      │
│                                         │
│ 🔗 View in Canvas Gradebook            │
└─────────────────────────────────────────┘
```

---

## 🎯 Multi-Modal Assessment Support

### 1. Multi-Modal Question Display

#### Component: `MultiModalQuestionDisplay.tsx`

**Purpose**: Rich content display supporting text, images, audio, and video

```typescript
interface MultiModalQuestionDisplayProps {
  question: MultiModalQuestion;
  onContentInteraction: (interaction: ContentInteraction) => void;
  accessibilityMode: AccessibilityMode;
  showCaptions: boolean;
  showTranscripts: boolean;
}

interface MultiModalQuestion {
  id: string;
  primaryText: string;
  mediaContent?: MediaContent[];
  interactiveElements?: InteractiveElement[];
  accessibilityAlternatives: AccessibilityAlternative[];
}

interface MediaContent {
  type: 'image' | 'video' | 'audio' | 'diagram' | 'simulation';
  url: string;
  altText: string;
  transcript?: string;
  captions?: Caption[];
  description: string;
}
```

**Responsive Media Layout**:
```css
.multimodal-question {
  display: grid;
  gap: 1rem;
  grid-template-areas:
    "text text"
    "media controls"
    "interaction interaction";
}

@media (max-width: 768px) {
  .multimodal-question {
    grid-template-areas:
      "text"
      "media"
      "controls"
      "interaction";
  }
}

.media-container {
  position: relative;
  max-width: 100%;
  border-radius: 8px;
  overflow: hidden;
}

.media-accessibility {
  position: absolute;
  bottom: 0.5rem;
  right: 0.5rem;
  display: flex;
  gap: 0.25rem;
}
```

### 2. Student Response Capture

#### Component: `ImageResponseCapture.tsx`

**Purpose**: Interface for students to submit image-based responses

```typescript
interface ImageResponseCaptureProps {
  onImageCapture: (image: CapturedImage) => void;
  allowedFormats: string[];
  maxFileSize: number;
  requireDescription: boolean;
  showImageAnalysis: boolean;
}

interface CapturedImage {
  file: File;
  dataUrl: string;
  description: string;
  analysisMetadata: ImageAnalysisMetadata;
  captureMethod: 'upload' | 'camera' | 'drag-drop';
}
```

#### Component: `AudioResponseRecorder.tsx`

**Purpose**: Voice response recording with transcription

```typescript
interface AudioResponseRecorderProps {
  onAudioCapture: (audio: AudioRecording) => void;
  maxDuration: number;
  showTranscription: boolean;
  enableRealTimeTranscription: boolean;
  onTranscriptionComplete?: (text: string) => void;
}

interface AudioRecording {
  audioBlob: Blob;
  duration: number;
  transcript?: string;
  confidence?: number;
  waveformData?: number[];
}
```

**Audio Interface Design**:
```
┌─────────────────────────────────────────┐
│ 🎤 Voice Response                       │
│                                         │
│     ●━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━●     │ ← Waveform
│                                         │
│ ⏺️ Record  ⏸️ Pause  ⏹️ Stop  🔊 Play    │
│                                         │
│ Duration: 0:23 / 2:00                  │
│                                         │
│ 📝 Live Transcription:                 │
│ "I think the answer is ATP production   │
│  because energy is needed for..."       │
│                                         │
│ [Use Recording] [Try Again] [Type Instead] │
└─────────────────────────────────────────┘
```

---

## 🔐 Security and Privacy Components

### 1. Academic Integrity Monitoring

#### Component: `SecurityValidation.tsx`

**Purpose**: Unobtrusive monitoring for academic integrity without anxiety

```typescript
interface SecurityValidationProps {
  sessionId: string;
  enableBehavioralAnalysis: boolean;
  enableResponseAnalysis: boolean;
  onIntegrityAlert: (alert: IntegrityAlert) => void;
  showSecurityStatus: boolean;
}

interface IntegrityAlert {
  type: 'timing_anomaly' | 'content_similarity' | 'behavioral_pattern';
  severity: 'low' | 'medium' | 'high';
  description: string;
  recommendedAction: string;
  evidence: Evidence[];
}
```

**Security Feedback (Student-Facing)**:
```
┌─────────────────────────────────────────┐
│ 🔒 Assessment Security: Active          │
│                                         │
│ Your work is being saved automatically  │
│ and monitored for academic integrity.   │
│                                         │
│ 📋 Remember:                           │
│ • Use your own words and ideas          │
│ • Ask for help if you need it          │
│ • Take your time to think through      │
│   each response                         │
│                                         │
│ 💡 This helps ensure fair assessment   │
│    for all students.                    │
└─────────────────────────────────────────┘
```

### 2. Privacy Compliance Interface

#### Component: `PrivacyNotification.tsx`

**Purpose**: Clear communication about data usage and privacy

```typescript
interface PrivacyNotificationProps {
  privacyLevel: 'minimal' | 'standard' | 'detailed';
  showDataUsage: boolean;
  onPrivacyAccept: () => void;
  onPrivacyDecline: () => void;
  allowCustomization: boolean;
}
```

---

## ⚡ Performance Optimization Specifications

### Loading Performance Targets
- **Initial assessment load**: <3 seconds (including Canvas context)
- **AI response generation**: <8 seconds with progress indicators
- **Message rendering**: <200ms for smooth conversation flow
- **Progress updates**: <100ms for real-time feedback
- **Grade passback**: <5 seconds with retry mechanisms

### Code Splitting Strategy

```typescript
// Lazy load heavy assessment components
const MultiModalQuestionDisplay = lazy(() =>
  import('./multimedia/MultiModalQuestionDisplay')
);

const AudioResponseRecorder = lazy(() =>
  import('./multimedia/AudioResponseRecorder')
);

const AssessmentSummary = lazy(() =>
  import('./completion/AssessmentSummary')
);

// Preload critical components
const criticalComponents = [
  () => import('./chat/ConversationalAssessmentInterface'),
  () => import('./progress/AssessmentProgressTracker'),
  () => import('./feedback/RealTimeFeedbackPanel')
];

// Preload on route enter
useEffect(() => {
  criticalComponents.forEach(component => component());
}, []);
```

### Caching Strategy

```typescript
// React Query configuration for assessment data
const assessmentQueryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 2 * 60 * 1000, // 2 minutes
      cacheTime: 5 * 60 * 1000, // 5 minutes
      retry: 3,
      retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000)
    }
  }
});

// Cache conversation history for offline access
const useConversationCache = (sessionId: string) => {
  const [cachedMessages, setCachedMessages] = useState<AssessmentMessage[]>([]);

  useEffect(() => {
    // Load from localStorage on init
    const cached = localStorage.getItem(`assessment-${sessionId}`);
    if (cached) {
      setCachedMessages(JSON.parse(cached));
    }
  }, [sessionId]);

  const updateCache = useCallback((messages: AssessmentMessage[]) => {
    setCachedMessages(messages);
    localStorage.setItem(`assessment-${sessionId}`, JSON.stringify(messages));
  }, [sessionId]);

  return { cachedMessages, updateCache };
};
```

---

## 🧪 Testing Strategy

### Component Testing

```typescript
describe('ConversationalAssessmentInterface', () => {
  const mockProps = {
    assessmentSessionId: 'session-123',
    canvasContext: createMockCanvasContext(),
    assessmentConfiguration: createMockConfiguration(),
    onAssessmentComplete: vi.fn(),
    onAssessmentExit: vi.fn(),
    accessibilityPreferences: createMockA11yPreferences()
  };

  it('should render initial chat interface correctly', () => {
    render(<ConversationalAssessmentInterface {...mockProps} />);

    expect(screen.getByRole('main')).toBeInTheDocument();
    expect(screen.getByLabelText(/assessment progress/i)).toBeInTheDocument();
    expect(screen.getByRole('textbox', { name: /response/i })).toBeInTheDocument();
  });

  it('should handle AI conversation flow', async () => {
    const user = userEvent.setup();

    render(<ConversationalAssessmentInterface {...mockProps} />);

    // Type student response
    const input = screen.getByRole('textbox', { name: /response/i });
    await user.type(input, 'ATP is produced during cellular respiration');

    // Submit response
    await user.click(screen.getByRole('button', { name: /send/i }));

    // Wait for AI response
    await waitFor(() => {
      expect(screen.getByText(/excellent understanding/i)).toBeInTheDocument();
    });

    // Verify progress update
    expect(screen.getByText(/progress: 1\/5/i)).toBeInTheDocument();
  });

  it('should handle assessment completion flow', async () => {
    const user = userEvent.setup();

    // Mock completed assessment state
    const completedProps = {
      ...mockProps,
      assessmentConfiguration: {
        ...mockProps.assessmentConfiguration,
        isComplete: true,
        finalScore: 85
      }
    };

    render(<ConversationalAssessmentInterface {...completedProps} />);

    await waitFor(() => {
      expect(screen.getByText(/assessment complete/i)).toBeInTheDocument();
      expect(screen.getByText(/85\/100/i)).toBeInTheDocument();
    });

    // Verify grade passback status
    expect(screen.getByText(/grade: sent to canvas/i)).toBeInTheDocument();
  });
});
```

### Accessibility Testing

```typescript
describe('Assessment Accessibility', () => {
  it('should support screen reader navigation', async () => {
    render(<ConversationalAssessmentInterface {...mockProps} />);

    // Verify ARIA landmarks
    expect(screen.getByRole('main')).toHaveAttribute('aria-label', /assessment interface/i);
    expect(screen.getByRole('log')).toHaveAttribute('aria-live', 'polite');

    // Test keyboard navigation
    const user = userEvent.setup();
    await user.tab();
    expect(screen.getByRole('button', { name: /accessibility options/i })).toHaveFocus();
  });

  it('should announce progress updates to screen readers', async () => {
    const user = userEvent.setup();

    render(<ConversationalAssessmentInterface {...mockProps} />);

    // Submit response that achieves mastery
    const input = screen.getByRole('textbox');
    await user.type(input, 'Correct answer');
    await user.click(screen.getByRole('button', { name: /send/i }));

    // Verify announcement
    await waitFor(() => {
      const status = screen.getByRole('status');
      expect(status).toHaveTextContent(/concept mastered/i);
    });
  });

  it('should support high contrast mode', () => {
    const highContrastProps = {
      ...mockProps,
      accessibilityPreferences: {
        ...mockProps.accessibilityPreferences,
        highContrast: true
      }
    };

    render(<ConversationalAssessmentInterface {...highContrastProps} />);

    const container = screen.getByRole('main');
    expect(container).toHaveClass('high-contrast');
  });
});
```

### Performance Testing

```typescript
describe('Assessment Performance', () => {
  it('should load within performance targets', async () => {
    const startTime = performance.now();

    render(<ConversationalAssessmentInterface {...mockProps} />);

    await waitFor(() => {
      expect(screen.getByRole('textbox')).toBeInTheDocument();
    });

    const loadTime = performance.now() - startTime;
    expect(loadTime).toBeLessThan(3000); // 3 second target
  });

  it('should handle rapid message exchanges efficiently', async () => {
    const user = userEvent.setup();

    render(<ConversationalAssessmentInterface {...mockProps} />);

    const input = screen.getByRole('textbox');
    const sendButton = screen.getByRole('button', { name: /send/i });

    // Rapidly send multiple messages
    for (let i = 0; i < 10; i++) {
      await user.clear(input);
      await user.type(input, `Test message ${i}`);
      await user.click(sendButton);
    }

    // Verify all messages are rendered
    await waitFor(() => {
      expect(screen.getAllByText(/test message/i)).toHaveLength(10);
    });
  });
});
```

---

## 📊 Success Metrics & KPIs

### User Experience Metrics
- **Assessment completion rate**: >90% of started assessments completed
- **Student satisfaction**: >4.3/5 average rating for assessment experience
- **Accessibility compliance**: 100% WCAG 2.1 AA conformance
- **Average completion time**: Within instructor-configured time limits
- **Error recovery success**: >95% successful recovery from technical issues

### Learning Effectiveness Metrics
- **Concept mastery rate**: >75% of students achieve mastery thresholds
- **Learning progression**: Measurable improvement in concept understanding
- **Feedback utilization**: >80% of students engage with remediation suggestions
- **Canvas grade correlation**: >90% correlation between AI scores and instructor validation

### Technical Performance Metrics
- **Initial load time**: <3 seconds for assessment interface
- **AI response latency**: <8 seconds for question generation and analysis
- **Message rendering**: <200ms for smooth conversation flow
- **Grade passback success**: >98% successful Canvas integration
- **Mobile compatibility**: >95% feature parity across device types

---

## 🚀 Implementation Roadmap

### Phase 1: Core Chat Interface (Weeks 1-2)
- [ ] `ConversationalAssessmentInterface.tsx` - Main chat container
- [ ] `AssessmentChatMessage.tsx` - Individual message components
- [ ] `ResponseInput.tsx` - Student input interface
- [ ] `TypingIndicator.tsx` - AI processing feedback
- [ ] Basic conversation flow and state management
- [ ] Canvas iframe integration and responsive design

### Phase 2: Progress & Feedback (Weeks 2-3)
- [ ] `AssessmentProgressTracker.tsx` - Visual progress display
- [ ] `MasteryVisualization.tsx` - Concept mastery indicators
- [ ] `RealTimeFeedbackPanel.tsx` - Immediate response feedback
- [ ] `MasteryCheckpoint.tsx` - Achievement celebrations
- [ ] Progress persistence and recovery mechanisms

### Phase 3: Accessibility & Multi-Modal (Weeks 3-4)
- [ ] Complete WCAG 2.1 AA compliance implementation
- [ ] `MultiModalQuestionDisplay.tsx` - Rich content support
- [ ] `AudioResponseRecorder.tsx` - Voice input capabilities
- [ ] `ImageResponseCapture.tsx` - Visual response submission
- [ ] Screen reader optimization and keyboard navigation

### Phase 4: Assessment Completion (Weeks 4-5)
- [ ] `AssessmentSummary.tsx` - Results and performance breakdown
- [ ] `GradePassbackStatus.tsx` - Canvas integration status
- [ ] `NextStepsGuidance.tsx` - Personalized learning recommendations
- [ ] Error recovery and retry mechanisms
- [ ] Security monitoring and privacy compliance

### Phase 5: Testing & Optimization (Weeks 5-6)
- [ ] Comprehensive testing across all components
- [ ] Performance optimization and code splitting
- [ ] Canvas compatibility validation across versions
- [ ] Mobile device testing and refinement
- [ ] Accessibility validation with assistive technologies

---

This comprehensive frontend specification provides the foundation for implementing Story 7.3's AI Chat Assessment System. The design prioritizes student learning experience, accessibility, and seamless Canvas integration while maintaining the high-quality standards of the Atomic Guide platform. The conversational interface reduces test anxiety while providing meaningful learning opportunities and reliable assessment outcomes.